# üîê –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò –° API - –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

## üìã –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

#### 1. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
- **AuthService** - –ø–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–í—Ö–æ–¥** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –ø–∞—Ä–æ–ª—é
- **–í—ã—Ö–æ–¥** - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - UserDefaults –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

#### 2. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- **AuthView** - –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **LoginFormView** - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
- **RegistrationFormView** - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **PremiumLogoutButton** - –∫—Ä–∞—Å–∏–≤–∞—è –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
- **UnauthenticatedProfileView** - —ç–∫—Ä–∞–Ω –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 3. **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö**
- **User** - –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **AuthCredentials** - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞
- **RegistrationData** - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **UserOrder** - –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **UserReservation** - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üöÄ –ü–õ–ê–ù –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° API

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (Backend)

#### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/auth/register
{
  "phoneNumber": "+79991234567",
  "password": "password123",
  "fullName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan@example.com"
}

// –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/auth/login
{
  "phoneNumber": "+79991234567",
  "password": "password123"
}

// –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/auth/logout
{
  "token": "jwt_token_here"
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /api/auth/refresh
{
  "refreshToken": "refresh_token_here"
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/auth/profile
Headers: { "Authorization": "Bearer jwt_token" }

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PUT /api/auth/profile
Headers: { "Authorization": "Bearer jwt_token" }
{
  "fullName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "email": "ivan@example.com"
}
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ API –º–æ–¥–µ–ª–µ–π (iOS)

#### –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è API:

```swift
// API –º–æ–¥–µ–ª–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
struct UserAPI: Codable, Identifiable {
    let id: String
    let phoneNumber: String
    let fullName: String
    let email: String?
    let avatar: String?
    let isVerified: Bool
    let createdAt: String
    let updatedAt: String
    
    enum CodingKeys: String, CodingKey {
        case id = "_id"
        case phoneNumber, fullName, email, avatar, isVerified
        case createdAt, updatedAt
    }
}

struct AuthResponse: Codable {
    let success: Bool
    let message: String
    let user: UserAPI?
    let token: String?
    let refreshToken: String?
}

struct LoginRequest: Codable {
    let phoneNumber: String
    let password: String
}

struct RegisterRequest: Codable {
    let phoneNumber: String
    let password: String
    let fullName: String
    let email: String?
}

struct LogoutRequest: Codable {
    let token: String
}
```

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ APIService

#### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ APIService:

```swift
// MARK: - Authentication
func register(_ request: RegisterRequest) -> AnyPublisher<AuthResponse, Error>
func login(_ request: LoginRequest) -> AnyPublisher<AuthResponse, Error>
func logout(_ request: LogoutRequest) -> AnyPublisher<AuthResponse, Error>
func refreshToken(_ refreshToken: String) -> AnyPublisher<AuthResponse, Error>
func getProfile(token: String) -> AnyPublisher<UserAPI, Error>
func updateProfile(token: String, user: UserAPI) -> AnyPublisher<UserAPI, Error>
```

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AuthService

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API:

```swift
class AuthService: ObservableObject {
    // –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
    @Published var accessToken: String?
    @Published var refreshToken: String?
    
    // –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
    func register(with data: RegistrationData) async {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ API
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    }
    
    func login(with credentials: AuthCredentials) async {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ API
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    }
    
    func logout() async {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ API –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    }
    
    // –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
    func refreshAccessToken() async -> Bool
    func updateUserProfile(_ user: User) async
    func validateToken() async -> Bool
}
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

1. **JWT —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. **Refresh —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
3. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **HTTPS** - –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
5. **Keychain** - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

1. **Keychain** - —Ç–æ–∫–µ–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏
2. **UserDefaults** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **Core Data** - –∫—ç—à –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏** - —Ç–∞–π–º–∞—É—Ç—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
2. **–û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω
3. **–û—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞** - 500, 503, etc.
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

---

## üì± –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –û–ü–´–¢

### –ü–æ—Ç–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**:
   - –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí –£—Å–ø–µ—Ö/–û—à–∏–±–∫–∞
   
2. **–í—Ö–æ–¥**:
   - –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   
3. **–í—ã—Ö–æ–¥**:
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí API –∑–∞–ø—Ä–æ—Å ‚Üí –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
   
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

1. **–ó–∞–≥—Ä—É–∑–∫–∞** - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
2. **–û—à–∏–±–∫–∏** - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
3. **–£—Å–ø–µ—Ö** - –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
4. **–û—Ñ–ª–∞–π–Ω** - —Ä–∞–±–æ—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ API –º–æ–¥–µ–ª–µ–π –≤ iOS
3. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ APIService
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AuthService

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keychain
2. ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
3. ‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
4. ‚è≥ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. ‚è≥ –ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
2. ‚è≥ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (Google, Apple)
3. ‚è≥ –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
4. ‚è≥ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–î–æ–±–∞–≤–∏—Ç—å API –º–æ–¥–µ–ª–∏** –≤ iOS –ø—Ä–æ–µ–∫—Ç
3. **–†–∞—Å—à–∏—Ä–∏—Ç—å APIService** –Ω–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
4. **–û–±–Ω–æ–≤–∏—Ç—å AuthService** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**

---

**–ì–æ—Ç–æ–≤–æ –∫ –Ω–∞—á–∞–ª—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!** üéâ
